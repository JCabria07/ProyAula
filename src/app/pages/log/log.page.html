<ion-content fullscreen>
  <app-navbar></app-navbar>

  <div class="container py-4">

    <!-- Spinner de carga -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-success" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">
        <i class="bi bi-hourglass-split me-2"></i>
        Cargando... Por favor espere
      </p>
    </div>

    <!-- Contenido principal -->
    <div *ngIf="!loading">

      <!-- Encabezado de filtros -->
      <h5 class="text-secondary mb-3">
        <i class="bi bi-filter-circle me-2"></i> Filtros de auditoría
      </h5>


      <!-- Contenedor de filtros -->
      <div class="filtros-container d-flex flex-wrap justify-content-between align-items-center px-3 py-2">

        <!-- Filtro por usuario -->
        <div class="dropdown me-2 mb-2">
          <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle me-1"></i>
            {{ filtroUsuario || 'Todos los usuarios' }}
          </button>
          <ul class="dropdown-menu">
            <li>
              <button class="dropdown-item" (click)="setFiltroUsuario('')">
                <i class="bi bi-people me-1"></i> Todos
              </button>
            </li>
            <li *ngFor="let u of usuarios">
              <button class="dropdown-item" (click)="setFiltroUsuario(u)">
                <i class="bi bi-person me-1"></i> {{ u }}
              </button>
            </li>
          </ul>
        </div>

        <!-- Filtro por acción -->
        <div class="dropdown me-2 mb-2">
          <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-funnel me-1"></i>
            {{ filtroAccion || 'Todas las acciones' }}
          </button>
          <ul class="dropdown-menu">
            <li>
              <button class="dropdown-item" (click)="setFiltroAccion('')">
                <i class="bi bi-list me-1"></i> Todas
              </button>
            </li>
            <li>
              <button class="dropdown-item" (click)="setFiltroAccion('login')">
                <i class="bi bi-box-arrow-in-right text-primary me-1"></i> Login
              </button>
            </li>
            <li>
              <button class="dropdown-item" (click)="setFiltroAccion('logout')">
                <i class="bi bi-box-arrow-right text-secondary me-1"></i> Logout
              </button>
            </li>
            <li>
              <button class="dropdown-item" (click)="setFiltroAccion('crear_categoria')">
                <i class="bi bi-plus-circle text-success me-1"></i> Crear categoría
              </button>
            </li>
            <li>
              <button class="dropdown-item" (click)="setFiltroAccion('editar_categoria')">
                <i class="bi bi-pencil-square text-warning me-1"></i> Editar categoría
              </button>
            </li>
            <li>
              <button class="dropdown-item" (click)="setFiltroAccion('eliminar_categoria')">
                <i class="bi bi-trash text-danger me-1"></i> Eliminar categoría
              </button>
            </li>
          </ul>
        </div>

        <!-- Contador -->
        <span class="badge bg-info mb-2">
          Mostrando {{ logsFiltrados.length }} registros
        </span>
      </div>

      <!-- Separador visual -->
      <hr class="my-3 border-top border-secondary opacity-25">

      <!-- Lista de logs -->
      <ion-list>
        <ion-item *ngFor="let log of logsFiltrados" class="log-item">
          <div class="log-icon" [ngClass]="log.accion" slot="start" [attr.title]="log.accion">
            <i [class]="getIcon(log.accion)"></i>
          </div>
          <ion-label>
            <h2>{{ log.detalle }}</h2>
            <p>
              <i class="bi bi-person-circle me-1"></i>{{ log.correo }} •
              <i class="bi bi-clock me-1"></i>{{ log.fecha?.toDate() | date:'medium' }}
            </p>
          </ion-label>
</ion-item>

      </ion-list>

      <!-- Footer -->
      <app-footer></app-footer>

    </div>
  </div>
</ion-content>